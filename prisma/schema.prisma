generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  username      String
  email         String
  kickId        String?  @unique
  tokens Decimal @db.Decimal(10, 2)
  refresh_token String?
  role          String?
  auth_user_id  String?  @unique
  kick_linked_at DateTime?
  kick_link_requested_at DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  tokenTransactions TokenTransaction[]
}

model GiveawayCounter {
  id        Int      @id @default(1)
  amount    Float
  updatedAt DateTime @updatedAt
}

model TokenTransaction {
  id              String   @id @default(uuid())
  userId          Int
  transactionType String   // 'convert', 'spend', 'payout', 'admin_adjustment', 'purchase'
  amount          Decimal  @db.Decimal(10, 2)
  balanceBefore   Decimal  @db.Decimal(10, 2)
  balanceAfter    Decimal  @db.Decimal(10, 2)
  metadata        Json?    // Additional context (e.g., game ID, product ID, admin ID)
  ipAddress       String?
  userAgent       String?
  createdAt       DateTime @default(now())

  user            User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([transactionType])
  @@index([createdAt])
}

model RazedLeaderboardCache {
  id            String   @id @default(uuid())
  cacheKey      String   @unique // Unique identifier for this cache entry (e.g., date range)
  data          Json     // The leaderboard data
  fetchedAt     DateTime @default(now()) // When data was fetched from API
  expiresAt     DateTime // When cache expires and needs refresh
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([expiresAt])
}

model SpartansLeaderboardCache {
  id            String   @id @default(uuid())
  cacheKey      String   @unique // Unique identifier for this cache entry (e.g., date range)
  data          Json     // The leaderboard data
  fetchedAt     DateTime @default(now()) // When data was fetched from API
  expiresAt     DateTime // When cache expires and needs refresh
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([expiresAt])
}

model LuxdropLeaderboardCache {
  id            String   @id @default(uuid())
  cacheKey      String   @unique // Unique identifier for this cache entry (e.g., date range or period)
  data          Json     // The leaderboard data
  period        Json?    // Period information (month, year, startDate, endDate, etc.)
  etag          String?  // ETag for cache validation
  fetchedAt     DateTime @default(now()) // When data was fetched from API
  expiresAt     DateTime // When cache expires and needs refresh
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([expiresAt])
}
